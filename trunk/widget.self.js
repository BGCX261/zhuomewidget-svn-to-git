var _ZMWG=window._ZMWG||((window.ZHUOME||{}).widget||{});if(!_ZMWG.initialized){_ZMWG={flags:{},constants:{titles:["话题","问题","缺点","创意","好评"],actions:["发起","提出","报告","分享","给出"]},hasClass:function(b,a){return ele.className.match(new RegExp("(\\s|^)"+cls+"(\\s|$)"));},addClass:function(b,a){if(!_ZMWG.util.hasClass(b,a)){b.className+=" "+a;}},removeClass:function(c,a){if(_ZMWG.util.hasClass(c,a)){var b=new RegExp("(\\s|^)"+a+"(\\s|$)");c.className=c.className.replace(b," ");}},show:function(a){a.style.display="block";},hide:function(a){a.style.display="none";},get:function(a){return document.getElementById(a);},addStyle:function(c){var a=document.getElementsByTagName("head")[0];var b=document.createElement("style");b.type="text/css";if(b.styleSheet){b.styleSheet.cssText=c;}else{b.appendChild(document.createTextNode(c));}a.appendChild(b);},switchType:function(a,b){if(!a||a=="0"){return;}$($("#uTopicType").find("li.on").removeClass("on").end().find("li")[a-1]).addClass("on");$("#iType").val(a);if(!b){$("#tTopicPredesc").focus();}$("#hActionTitle").text(this.constants.actions[a]+"一个"+this.constants.titles[a]);$("#hTopicList").text("社区中的热门"+this.constants.titles[a]);this.loadPopularTopic(a);},labelHint:function(b,c){var d=$(b),a=$(c);d.focus(function(){a.hide();}).blur(function(){$.trim(d.val())?a.hide():a.show();});a.click(function(){d.focus();});},loadPopularTopic:function(c){var d;if(d=_ZMWG.flags["popCache"+c]){a(d);}else{$("#uPopTopic").html("<li><div class='loadBlock'></div></li>");var e=[{name:"groupID",value:window._groupID},{name:"type",value:c}];if(window.products&&window.products.length){for(var b=0;b<window.products.length;b++){e.push({name:"productID",value:window.products[b]});}}if(window._limit){e.push({name:"limit",value:window._limit});}_ZMWG.doAjax("loadPopularTopic","/widgetQueryPopularTopic.do",e,function(f){_ZMWG.flags["popCache"+c]=f.result?f.result:" ";a(_ZMWG.flags["popCache"+c]);});}function a(f){if(f==" "){$("#uPopTopic").html("<li>社区中还没有"+_ZMWG.constants.titles[c]+"，赶快"+_ZMWG.constants.actions[c]+"吧！</li>");}else{$("#uPopTopic").html(f);}_ZMWG.resizeIframe();}},toggleMore:function(a){var b=$(a);if(b.hasClass("close")){$("#dMore").show();b.removeClass("close");_ZMWG.resizeIframe();}else{$("#dMore").hide();b.addClass("close");_ZMWG.resizeIframe();}if(!$("#dMore>p").length){$("#dMore").append("<div class='loadBlock'></div>");_ZMWG.doAjax("toggleMore","/queryProductByGroupID.do",[{name:"groupID",value:window._groupID}],function(c){if(c.result&&c.result.length){$("#dMore").empty().append("<p class='fontW mb5'>请选择和话题相关的产品或服务</p>");$.each(c.result,function(f,g){var e=g.productID,d=g.productName;$("#dMore").append("<p class='floatL'><input id='p"+e+"' type='checkbox' value='"+e+"'"+(window.products&&$.inArray(e,products)>=0?" checked='checked'":"")+"></input><label for='p"+e+"'>"+d+"</label><a target='_blank' href='/group/"+g.groupID+"/product/"+e+"'>详细</a></p>");});}else{$("#dMore").html("<p>社区中还没有添加任何产品或服务</p>");}_ZMWG.resizeIframe();});}},addTopic:function(){var e=[];e.push({name:"groupID",value:window._groupID});var d=$("#iTopicTitle").val();var c=$("#tTopicContent").val();var b=$("#iType").val();e.push({name:"title",value:d});e.push({name:"content",value:c});e.push({name:"contentText",value:c});e.push({name:"type",value:b});var d=$("#iTopicTitle").val();if(!$.trim(d)||!$.trim(c)){_ZMWG.prompt("请填写清楚话题的标题和内容");return;}_ZMWG.hidePrompt();$("#dMore").find("input:checked").each(function(g,h){var f=$(h).val();if($.inArray(f,products)<0){products.push(f);}});for(var a=0;a<products.length;a++){e.push({name:"product",value:products[a]});}if(window._zmwg_source){e.push({name:"source_url",value:_zmwg_source});}_ZMWG.prompt("正在提交话题...");_ZMWG.doAjax("addTopic","/addTopic.do",e,function(g){if(g.result){var f="/group/"+window._groupID+"/topic/"+g.result;$("#dStep3").show();$("#dStep2").hide();$("#dStep0").hide();$("#uTopicType").hide();$("#aSuccessLink").attr("href",f).text(d);$("#aSuccessLink1").attr("href",f);$("#aSucessRss").attr("href",f+"/rss.xml");$("#aSuccessEmail").unbind("click").click(function(){_ZMWG.recordEmail(g.result);});$("#dSuccessEmail").show();$("#pSuccessEmail").text("填写邮箱，我们会第一时间将准确的答案发送给你");_ZMWG.hidePrompt();_ZMWG.resizeIframe();}});},newTopic:function(){$("#dStep3").hide();$("#dStep1").show();$("#uTopicType").show();$("#tTopicPredesc").val("").focus();_ZMWG.resizeIframe();},cancelPost:function(){$("#dStep1").show();$("#dStep2").hide();$("#dStep0").hide();$("#tTopicPredesc").focus();_ZMWG.resizeIframe();},recordEmail:function(b){var a=$("#iSuccessEmail").val();if(!_ZMWG.checkEmail(a)){_ZMWG.prompt("Email格式有误");return;}_ZMWG.hidePrompt();_ZMWG.doAjax("recordEmail","/addAnonymous.do",[{name:"id",value:b},{name:"type",value:1},{name:"email",value:a}],function(c){$("#dSuccessEmail").hide();$("#iSuccessEmail").val("");$("#pSuccessEmail").text("邮箱已保存");});},doAjax:function(flag,url,param,callback){if(_ZMWG.flags[flag]){return;}_ZMWG.flags[flag]=true;$.post(url,param,function(data){data=eval("("+data+")");if(data&&data.flag){if(callback&&$.isFunction(callback)){callback(data);}}else{if(data.error){_ZMWG.prompt(data.error);}}_ZMWG.flags[flag]=false;});},prompt:function(a){$("#dPrompt").html(a).show();_ZMWG.resizeIframe();},hidePrompt:function(){$("#dPrompt").hide();_ZMWG.resizeIframe();},tabSwitch:function(b){var a=$(b);a.parent().find("a").removeClass("wTags_on");a.addClass("wTags_on");$("div.zmwg_tabs").hide();$("#"+a.attr("id")+"Div").show();_ZMWG.hidePrompt();},search:function(b,c,e,a){var d;if(d=_ZMWG.flags["topicCache-"+e]){a(d);}else{$("#dSearchPrompt").show();$("#tTopicPredesc").attr("disabled","disabled");_ZMWG.doAjax("searchGroup","/widgetSearchGroupTopic.do",[{name:"groupID",value:b},{name:"type",value:c},{name:"q",value:e}],function(f){$("#dSearchPrompt").hide();$("#tTopicPredesc").removeAttr("disabled");_ZMWG.flags["topicCache-"+e]=f.result?f.result:" ";a(_ZMWG.flags["topicCache-"+e]);});}},searchBeforePost:function(){var a=$("#tTopicPredesc").val();if(!$.trim(a)){_ZMWG.prompt("请填写清楚话题内容");return;}_ZMWG.hidePrompt();_ZMWG.search(window._groupID,$("#iType").val(),a,function(b){$("#dStep1").hide();$("#dStep2").show();$("#dStep0").show();if(a.length>15){$("#iTopicTitle").val("");$("#tTopicContent").val(a);$("#tTopicContent").blur();$("#iTopicTitle").addClass("wgselect").focus();}else{$("#iTopicTitle").val(a);$("#tTopicContent").val("");$("#iTopicTitle").removeClass("wgselect").blur();$("#tTopicContent").focus();}if(b==" "){$("#pSearchPrompt").text("社区中没有相关话题，请将内容填写完整，点击‘我要发布’");$("#uPostSearch").hide();_ZMWG.resizeIframe();}else{$("#pSearchPrompt").text("下面的几个话题和你要提出的话题非常接近，查看这些话题可以快速获得答案");$("#uPostSearch").html(b);_ZMWG.resizeIframe();}});},voteTopic:function(a,b){_ZMWG.doAjax("voteTopic","/voteTopic.do",[{name:"topicID",value:a}],function(c){$(b).replaceWith("<p class='font_sub'>已查看此话题</p>");});},resizeIframe:function(){var a=document.getElementById("cross_domain");if(!a||!window._display||_display!="embed"){return;}a.src="http://"+window._domain+"#"+$(document.body).height();},checkEmail:function(a){var c=/^[_\.0-9A-Za-z]+@([0-9A-Za-z][0-9A-Za-z]+\.){1,4}[A-Za-z]{2,3}$/;var b=new RegExp(c);return b.test(a);}};_ZMWG.initialized=true;}_ZMWG.postWidget=function(c){this.options=c||{};if(!this.options.needpost){this.options.needpost="yes";}if(this.options.display=="popup"){if(!this.options.text){this.options.text="琢么一下";}if(!this.options.style){this.options.style="fixed";}if(!this.options.color){this.options.color="gray";}if(!this.options.colour){this.options.colour="orange";}if(!this.options.tcolor){this.options.tcolor="#000000";}}if(this.options.display=="embed"){document.write('<iframe id="zmwg_iframe" name="zmwg_iframe" src="'+(this.options.groupid?this.combineQueryString(this.options):this.combineSuggestQueryString(this.options))+'" allowTransparency="true" scrolling="no" frameborder="0" width="100%"></iframe>');}else{if(this.options.display=="popup"){var h=this.options.position?this.options.position:"right";var d;if(this.options.style=="fixed"){var a;if(this.options.colour=="orange"){a="-86px";}else{if(this.options.colour=="blue"){a="-43px";}else{if(this.options.colour=="red"){a="-129px";}else{if(this.options.colour=="pink"){a="-172px";}else{if(this.options.colour=="gray"){a="right";}else{a="left";}}}}}d="url(http://www.zhuome.cn/images/images_widget/fixed_button.png) no-repeat "+a;}else{d="url(http://www.zhuome.cn/images/images_widget/align_"+this.options.color+".png) no-repeat";}this.addStyle(this.options);document.write('<a target="_self" href="javascript:;" id="zmwg_handle" class="zmwg_handle_'+h+'" style="color:'+this.options.tcolor+";background:"+d+";"+(this.options.rpos?"top:"+this.options.rpos+"%;_top:expression(eval(document.documentElement.scrollTop));left:"+this.options.rpos+"%;":"")+'">'+this.options.text+"</a>");document.write('<div style="height:0;line-height:0;font-size:0px;font-weight:normal;border:none;clear:both;"></div>');var f=document.getElementById("zmwg_handle");if(this.options.site=="left"||this.options.site=="right"){f.style.styleFloat=this.options.site;f.style.cssFloat=this.options.site;}else{f.style.margin="0 auto";}var e=this;_ZMWG.get("zmwg_handle").onclick=function(i){e.showPop();};var b=document.createElement("div");b.id="zmwg_pop";b.style.display="none";b.innerHTML='	<div id="zmwg_con">		<a target="_self" href="javascript:;" id="zmwg_close"></a>		<iframe id="zmwg_iframe" name="zmwg_iframe" class="loading" allowTransparency="true" scrolling="no" frameborder="0" width="100" height="100"></iframe>	</div>	<div id="zmwg_block"></div>';var g=window.onload;window.onload=function(){if(g&&typeof g=="function"){g();}document.body.appendChild(b);_ZMWG.get("zmwg_close").onclick=function(i){_ZMWG.hide(_ZMWG.get("zmwg_pop"));};};}else{if(this.options.display=="text"&&document.domain=="www.zhuome.cn"){this.addStyle(this.options);document.write('<a target="_self" href="javascript:;" id="zmwg_handle" style="font-weight:normal;display:inline;">'+this.options.text+"</a>");var e=this;_ZMWG.get("zmwg_handle").onclick=function(i){e.showPop();};var b=document.createElement("div");b.id="zmwg_pop";b.style.display="none";b.innerHTML='	<div id="zmwg_con">		<a target="_self" href="javascript:;" id="zmwg_close"></a>		<iframe id="zmwg_iframe" name="zmwg_iframe" class="loading" allowTransparency="true" scrolling="no" frameborder="0" width="100" height="100"></iframe>	</div>	<div id="zmwg_block"></div>';var g=window.onload;window.onload=function(){if(g&&typeof g=="function"){g();}document.body.appendChild(b);_ZMWG.get("zmwg_close").onclick=function(i){_ZMWG.hide(_ZMWG.get("zmwg_pop"));};};}}}};_ZMWG.postWidget.prototype={options:{},url_prefix:"http://www.zhuome.cn/",showPop:function(){var a=_ZMWG.get("zmwg_iframe").getAttribute("src");if(!a){var b=this.options.groupid?this.combineQueryString(this.options):this.combineSuggestQueryString(this.options);_ZMWG.get("zmwg_iframe").setAttribute("src",b);_ZMWG.show(_ZMWG.get("zmwg_pop"));if(_ZMWG.get("zmwg_iframe").addEventListener){_ZMWG.get("zmwg_iframe").addEventListener("load",this.popLoaded,false);}else{if(_ZMWG.get("zmwg_iframe").attachEvent){_ZMWG.get("zmwg_iframe").attachEvent("onload",this.popLoaded);}}this.scroll_top=document.documentElement.scrollTop||document.body.scrollTop;this.scroll_height=document.documentElement.scrollHeight;this.client_height=window.innerHeight||document.documentElement.clientHeight;_ZMWG.get("zmwg_block").style.height=this.scroll_height+"px";_ZMWG.get("zmwg_con").style.top=this.scroll_top+(this.client_height*0.1)+"px";}else{_ZMWG.show(_ZMWG.get("zmwg_pop"));}},combineQueryString:function(b){var a=this.url_prefix+"widget/post?groupid="+b.groupid+"&code="+b.code+"&domain="+document.domain+"&url="+encodeURI(location.href).replace("'","%5C'");if(b.needpost){a+="&post=true";}if(b.product){a+="&pid="+b.product;}if(b.type){a+="&type="+b.type;}if(b.limit){a+="&limit="+b.limit;}if(b.css){a+="&css="+b.css;}if(b.position){a+="&position="+b.position;}if(b.display){a+="&display="+b.display;}return a;},combineSuggestQueryString:function(b){var a=this.url_prefix+"widget/post?modify="+new Date(document.lastModified).getTime()+"&title="+encodeURI(document.title)+"&code="+b.code+"&domain="+document.domain+"&url="+location.href;if(b.defaultid){a+="&defaultid="+b.defaultid;}if(b.needpost){a+="&post=true";}if(b.product){a+="&pid="+b.product;}if(b.type){a+="&type="+b.type;}if(b.limit){a+="&limit="+b.limit;}if(b.css){a+="&css="+b.css;}if(b.position){a+="&position="+b.position;}if(b.display){a+="&display="+b.display;}return a;},popLoaded:function(){_ZMWG.get("zmwg_iframe").className="";},addStyle:function(a){var b="* html,* html body {background-image:url(about:blank);background-attachment:fixed;}a#zmwg_handle{top:50%;left:50%;position:fixed;_position:absolute;_top:expression(eval(document.documentElement.scrollTop));_margin-top:300px;padding:10px;width:23px;height:129px;line-height:24px;font-family:'微软雅黑','黑体';font-weight:bold;font-size:18px;text-decoration:none;}a.zmwg_handle_right{right:-4px !important;left:auto !important;margin-right:0 !important;margin-left:auto !important;}a.zmwg_handle_right:hover{margin-left:auto !important;right:0 !important;}a.zmwg_handle_left{left:-4px !important;right:auto !important;margin-right:auto !important;margin-left:0 !important;}a.zmwg_handle_left:hover{margin-right:auto !important;left:0 !important;}a.zmwg_handle_hidden{display:none !important;}";var c="#zmwg_pop{width:100%;top:0;left:0;z-index:1000000;position:absolute;}#zmwg_close{background:url('http://www.zhuome.cn/images/close.gif') no-repeat 0 0 ;height:17px;position:absolute;top:5px;right:5px;width:17px;overflow:hidden;z-index:4;}#zmwg_close:hover{background:url('http://www.zhuome.cn/images/close.gif') no-repeat -20px 0;}#zmwg_block{top:0;left:0;z-index:1;width:100%;position:absolute;background-color:#000;opacity:0.5;-moz-opacity:0.5;filter:alpha(opacity=50)\9;}#zmwg_con{width:520px;height:100%;margin:0 auto;z-index:2;position:relative;}#zmwg_con iframe{width:525px;height:662px;background:transparent;margin:0 auto;}#zmwg_con iframe.loading{margin-top:5px;margin-left:10px;background:transparent url(http://www.zhuome.cn/images/images_common/load_block.gif) no-repeat 400px 0;}#zmwg_handle{font-size:12px;text-decoration:none;cursor:pointer;overflow:hidden;z-index:100000;display:block;clear:both;text-align:center;font-weight:bold;width:80px;height:23px;line-height:21px;}";if(a.style=="fixed"){_ZMWG.addStyle(c+b);}else{_ZMWG.addStyle(c);}}};